<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shipping — Aotearoa Adventure Gear</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/custom.css">
</head>
<body>

<header class="site-header">
  <nav class="navbar navbar-expand-lg navbar-light container-limited">
    <a class="navbar-brand" href="index.html">
      <img src="assets/images/BIT703-A2-01-AotearoaAdventureGearLogo-Graphic-2025-04.png" alt="logo" style="height:44px;">
    </a>
  </nav>
</header>

<main>
  <div class="container container-limited py-4">
    <h2>Shipping details</h2>

    <!-- Shipping form -->
    <form id="shippingForm" class="row g-3 needs-validation" novalidate>

      <div class="col-md-6">
        <label for="fullName" class="form-label">Full name</label>
        <input id="fullName" name="fullName" type="text" class="form-control" required>
        <div class="invalid-feedback">Please enter your full name.</div>
      </div>

      <div class="col-md-6">
        <label for="email" class="form-label">Email</label>
        <input id="email" name="email" type="email" class="form-control" required>
        <div class="invalid-feedback">Enter a valid email address.</div>
      </div>

      <div class="col-12">
        <label for="address" class="form-label">Address</label>
        <input id="address" name="address" type="text" class="form-control" required>
        <div class="invalid-feedback">Please provide a shipping address.</div>
      </div>

      <div class="col-md-4">
        <label for="city" class="form-label">City / Suburb</label>
        <input id="city" name="city" type="text" class="form-control" required>
        <div class="invalid-feedback">City is required.</div>
      </div>

      <div class="col-md-4">
        <label for="postal" class="form-label">Postal Code</label>
        <!-- NZ postal codes are 4 digits -->
        <input id="postal" name="postal" type="text" class="form-control" pattern="^\d{4}$" placeholder="e.g. 1010" required>
        <div class="invalid-feedback">Enter a 4-digit NZ postal code.</div>
      </div>

      <div class="col-md-4">
        <label for="country" class="form-label">Country</label>
        <input id="country" name="country" type="text" class="form-control" value="New Zealand" required>
        <div class="invalid-feedback">Country is required.</div>
      </div>

      <div class="col-md-6">
        <label for="phone" class="form-label">Phone</label>
        <!-- NZ phone numbers: 9-11 digits (basic check) -->
        <input id="phone" name="phone" type="tel" class="form-control" pattern="^\d{9,11}$" placeholder="e.g. 0212345678" required>
        <div class="invalid-feedback">Enter a valid NZ phone number (9–11 digits).</div>
      </div>

      <!-- SHIPPING SELECTION -->
      <div class="col-12">
        <h5>Shipping method</h5>

        <div class="form-check">
          <input class="form-check-input" type="radio" name="shipping" id="ship-free" value="0" checked>
          <label class="form-check-label" for="ship-free">
            Standard shipping (Free for orders over $600)
          </label>
        </div>

        <div class="form-check">
          <input class="form-check-input" type="radio" name="shipping" id="ship-next" value="20">
          <label class="form-check-label" for="ship-next">
            Next day delivery (+$20)
          </label>
        </div>
      </div>

      <!-- TOTAL SUMMARY -->
      <div class="col-12 text-end">
        <p>Subtotal: <strong id="subtotalDisplay" data-subtotal="650">$650</strong></p>
        <p>Shipping: <strong id="shippingDisplay">FREE</strong></p>
        <p>Total: <strong id="totalDisplay">$650</strong></p>
      </div>

      <div class="col-12 text-end">
        <a href="cart.html" class="btn btn-outline-secondary">Back to cart</a>
        <button type="submit" class="btn btn-primary"> Proceed to payment</button>
      </div>

    </form>
  </div>
</main>

<footer class="site-footer">
  <div class="container container-limited">
    <div class="row">
      <div class="col">© 2025 Aotearoa Adventure Gear</div>
    </div>
  </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Inline JS: form validation + free shipping logic -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const form = document.getElementById('shippingForm');
  const subtotalEl = document.getElementById('subtotalDisplay');
  const shippingEl = document.getElementById('shippingDisplay');
  const totalEl = document.getElementById('totalDisplay');
  const shipFree = document.getElementById('ship-free');
  const shipNext = document.getElementById('ship-next');

  // Parse subtotal and taxes (if any)
  const subtotal = parseFloat(subtotalEl.dataset.subtotal || '0');
  const taxes = parseFloat(totalEl.dataset.taxes || '0') || 0;
  const FREE_THRESHOLD = 600;

  // Update shipping and total display
  function updateTotals() {
    // If subtotal exceeds threshold, shipping is free regardless of selection
    let shippingCost = 0;
    if (subtotal > FREE_THRESHOLD) {
      shippingCost = 0;
      // ensure free option is selected visually
      if (!shipFree.checked) shipFree.checked = true;
    } else {
      shippingCost = shipNext.checked ? parseFloat(shipNext.value) : 0;
    }

    shippingEl.textContent = shippingCost === 0 ? 'FREE' : `$${shippingCost.toFixed(2)}`;
    const total = subtotal + shippingCost + taxes;
    totalEl.textContent = `$${total.toFixed(2)}`;
  }

  // Initial update
  updateTotals();

  // Listen for shipping option changes
  [shipFree, shipNext].forEach(radio => {
    radio.addEventListener('change', updateTotals);
  });

  // Bootstrap native validation + custom handling
  form.addEventListener('submit', (e) => {
    // Let HTML5 validation run first
    if (!form.checkValidity()) {
      e.preventDefault();
      e.stopPropagation();
      form.classList.add('was-validated');
      return;
    }

    // Additional JS checks (if needed)
    // Example: ensure postal code matches NZ 4-digit pattern
    const postal = document.getElementById('postal') || document.querySelector('input[name="postal"]');
    if (postal) {
      const postalVal = postal.value.trim();
      if (!/^\d{4}$/.test(postalVal)) {
        e.preventDefault();
        e.stopPropagation();
        postal.classList.add('is-invalid');
        postal.nextElementSibling && (postal.nextElementSibling.textContent = 'Enter a 4-digit NZ postal code.');
        form.classList.add('was-validated');
        return;
      }
    }

    // If everything is valid, proceed to payment page
    // For static demo, redirect to payment.html
    e.preventDefault();
    // Optionally store shipping selection in localStorage for demo
    const selectedShipping = document.querySelector('input[name="shipping"]:checked').value;
    localStorage.setItem('aag_subtotal', subtotal.toFixed(2));
    localStorage.setItem('aag_shipping', selectedShipping);
    localStorage.setItem('aag_total', (subtotal + parseFloat(selectedShipping || 0) + taxes).toFixed(2));
    window.location.href = 'payment.html';
  });
});
</script>

</body>
</html>
