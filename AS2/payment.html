<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Payment — Aotearoa Adventure Gear</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/custom.css">
</head>
<body>

<header class="site-header">
  <nav class="navbar navbar-expand-lg navbar-light container-limited">
    <a class="navbar-brand" href="index.html">
      <img src="assets/images/BIT703-A2-01-AotearoaAdventureGearLogo-Graphic-2025-04.png" alt="logo" style="height:44px;">
    </a>
  </nav>
</header>

<main>
  <div class="container container-limited py-4">
    <h2>Payment options</h2>

    <div class="row g-3">

      <!-- Discount codes -->
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Discount codes</h5>
          <p class="small text-muted">Apply promo or discount code.</p>
          <div class="input-group">
            <input id="discountCode" type="text" class="form-control" placeholder="Enter code">
            <button id="applyDiscount" class="btn btn-outline-secondary" type="button">Apply</button>
          </div>
          <div id="discountMsg" class="form-text text-success" style="display:none;">Discount applied.</div>
        </div>
      </div>

      <!-- Gift cards -->
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Gift cards</h5>
          <p class="small text-muted">Redeem a gift card</p>
          <div class="input-group">
            <input id="giftCard" type="text" class="form-control" placeholder="Gift card code">
            <button id="redeemGift" class="btn btn-outline-secondary" type="button">Redeem</button>
          </div>
          <div id="giftMsg" class="form-text text-success" style="display:none;">Gift card redeemed.</div>
        </div>
      </div>

      <!-- Payment form -->
      <div class="col-12">
        <div class="card p-3">
          <h5>Card payment</h5>

          <form id="paymentForm" class="row g-3 needs-validation" novalidate>
            <div class="col-md-12">
              <label for="cardNumber" class="form-label">Card number</label>
              <input id="cardNumber" name="cardNumber" type="text" inputmode="numeric" pattern="^\d{13,19}$" class="form-control" placeholder="1234 5678 9012 3456" required>
              <div class="invalid-feedback">Enter a valid card number (13–19 digits).</div>
            </div>

            <div class="col-md-4">
              <label for="exp" class="form-label">Expiry (MM/YY)</label>
              <input id="exp" name="exp" type="text" pattern="^(0[1-9]|1[0-2])\/\d{2}$" class="form-control" placeholder="MM/YY" required>
              <div class="invalid-feedback">Enter expiry in MM/YY format.</div>
            </div>

            <div class="col-md-4">
              <label for="cvv" class="form-label">CVV</label>
              <input id="cvv" name="cvv" type="text" pattern="^\d{3,4}$" class="form-control" placeholder="123" required>
              <div class="invalid-feedback">Enter a 3–4 digit CVV.</div>
            </div>

            <div class="col-md-4">
              <label for="holder" class="form-label">Cardholder name</label>
              <input id="holder" name="holder" type="text" class="form-control" required>
              <div class="invalid-feedback">Cardholder name required.</div>
            </div>

            <div class="col-12 text-end">
              <button id="payNow" type="submit" class="btn btn-primary">Pay now (Demo)</button>
              <a href="shipping.html" class="btn btn-outline-secondary">Back</a>
            </div>
          </form>

        </div>
      </div>

    </div>
  </div>
</main>

<footer class="site-footer">
  <div class="container container-limited">
    <div class="row">
      <div class="col">© 2025 Aotearoa Adventure Gear</div>
    </div>
  </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Inline JS: discount/gift demo + payment validation -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Demo discount/gift handlers
  const applyDiscount = document.getElementById('applyDiscount');
  const discountMsg = document.getElementById('discountMsg');
  applyDiscount && applyDiscount.addEventListener('click', () => {
    // Demo: pretend discount applied
    discountMsg.style.display = 'block';
    discountMsg.textContent = 'Discount applied (demo).';
    setTimeout(() => discountMsg.style.display = 'none', 3000);
  });

  const redeemGift = document.getElementById('redeemGift');
  const giftMsg = document.getElementById('giftMsg');
  redeemGift && redeemGift.addEventListener('click', () => {
    giftMsg.style.display = 'block';
    giftMsg.textContent = 'Gift card redeemed (demo).';
    setTimeout(() => giftMsg.style.display = 'none', 3000);
  });

  // Payment form validation
  const paymentForm = document.getElementById('paymentForm');

  // Helper: check expiry not in past
  function expiryValid(mmYY) {
    if (!/^(0[1-9]|1[0-2])\/\d{2}$/.test(mmYY)) return false;
    const parts = mmYY.split('/');
    const mm = parseInt(parts[0], 10);
    const yy = parseInt(parts[1], 10);
    // Build a date at end of month
    const current = new Date();
    const fullYear = 2000 + yy;
    const expiryDate = new Date(fullYear, mm, 0, 23, 59, 59); // last day of month
    return expiryDate >= new Date(current.getFullYear(), current.getMonth(), 1);
  }

  paymentForm && paymentForm.addEventListener('submit', (e) => {
    // HTML5 validity
    if (!paymentForm.checkValidity()) {
      e.preventDefault();
      e.stopPropagation();
      paymentForm.classList.add('was-validated');
      return;
    }

    // Extra JS checks
    const cardNumber = document.getElementById('cardNumber').value.replace(/\s+/g, '');
    const exp = document.getElementById('exp').value.trim();
    const cvv = document.getElementById('cvv').value.trim();
    const holder = document.getElementById('holder').value.trim();

    const errors = [];
    if (!/^\d{13,19}$/.test(cardNumber)) errors.push('Invalid card number (13–19 digits).');
    if (!expiryValid(exp)) errors.push('Invalid or expired expiry date (MM/YY).');
    if (!/^\d{3,4}$/.test(cvv)) errors.push('Invalid CVV (3–4 digits).');
    if (holder.length === 0) errors.push('Cardholder name is required.');

    if (errors.length) {
      e.preventDefault();
      e.stopPropagation();
      paymentForm.classList.add('was-validated');
      alert('Payment form errors:\n' + errors.join('\n'));
      return;
    }

    // Demo: store order summary and redirect to confirmation page
    e.preventDefault();
    // Optionally read totals from localStorage (set on shipping page)
    const subtotal = localStorage.getItem('aag_subtotal') || '0.00';
    const shipping = localStorage.getItem('aag_shipping') || '0.00';
    const total = localStorage.getItem('aag_total') || subtotal;
    localStorage.setItem('aag_payment_method', 'card');
    localStorage.setItem('aag_cardholder', holder);
    // Redirect to a confirmation page (static demo)
    window.location.href = 'confirmation.html';
  });
});
</script>

</body>
</html>
